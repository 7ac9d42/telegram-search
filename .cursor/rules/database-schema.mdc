---
description:
globs:
alwaysApply: false
---
# 数据库结构

数据库使用 PostgreSQL 和 Drizzle ORM。主要表结构定义位于 [packages/core/src/db/schema.ts](mdc:packages/core/src/db/schema.ts)。

## 主要表

### 消息表

[chatMessagesTable](mdc:packages/core/src/db/schema.ts) 存储所有聊天消息。

关键字段：
- `id`: UUID 主键
- `platform`: 平台标识 (Telegram)
- `platform_message_id`: 平台消息 ID
- `from_id`: 发送者 ID
- `from_name`: 发送者名称
- `in_chat_id`: 聊天会话 ID
- `content`: 消息内容
- `content_vector_1536/1024/768`: 向量索引，用于语义搜索

### 贴纸表

[stickersTable](mdc:packages/core/src/db/schema.ts) 存储贴纸数据。

关键字段：
- `id`: UUID 主键
- `name`: 贴纸名称
- `emoji`: 关联表情
- `file_id`: 文件 ID
- `description`: 描述
- `description_vector_1536/1024/768`: 向量索引，用于语义搜索

### 贴纸包表

[stickerPacksTable](mdc:packages/core/src/db/schema.ts) 存储贴纸包信息。

### 照片表

[photosTable](mdc:packages/core/src/db/schema.ts) 存储图片数据。

关键字段：
- `file_id`: 文件 ID
- `caption`: 图片标题
- `description`: 描述
- `description_vector_1536/1024/768`: 向量索引，用于语义搜索

### 聊天会话表

[joinedChatsTable](mdc:packages/core/src/db/schema.ts) 存储已加入的聊天会话。

关键字段：
- `chat_id`: 会话 ID
- `chat_name`: 会话名称
- `chat_type`: 会话类型 (user/channel/group)

## 视图

[chatMessageStatsView](mdc:packages/core/src/db/schema.ts) 提供聊天统计信息，包括每个聊天的消息数量和最新消息时间。

## 向量搜索

数据库支持使用 pgvector 进行向量搜索，各表都有相应的向量字段和索引：
- 消息内容向量索引
- 贴纸描述向量索引
- 图片描述向量索引
